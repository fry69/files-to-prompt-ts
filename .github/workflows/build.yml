name: Build

on:
  release:
    types: [created]

jobs:

  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup Bun
      uses: ./.github/workflows/setup-bun.yml

    - name: Build minified version
      run: |
        bun build --minify files-to-prompt.ts --outfile minified/fts-${{ github.ref_name }}-min.js

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: fts-minified
        path: minified/fts-${{ github.ref_name }}-min.js

    - name: Commit minified version
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add minified/fts-${{ github.ref_name }}-min.js
        git commit -m "Add minified version: fts-${{ github.ref_name }}-min.js"
        git push
